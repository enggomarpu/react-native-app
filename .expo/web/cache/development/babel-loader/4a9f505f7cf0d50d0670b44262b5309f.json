{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\Umar\\\\Music\\\\my-app\\\\screens\\\\Profile.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { memo, useEffect, useState } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport * as FaceDetector from \"expo-face-detector\";\nimport { useIsFocused } from \"@react-navigation/native\";\nimport { Camera } from \"expo-camera\";\nimport { contains } from \"../navigation/types\";\nimport { theme } from \"../core/theme\";\nimport Background from \"../components/Background\";\nimport AppBar from \"../components/AppBar\";\nimport Text from \"react-native-web/dist/exports/Text\";\n\nvar _Dimensions$get = Dimensions.get(\"window\"),\n    windowWidth = _Dimensions$get.width;\n\nvar ACTIONS = {\n  BLINK: 0.3,\n  TURN_HEAD_LEFT: -15,\n  TURN_HEAD_RIGHT: 15\n};\nvar PREVIEW_SIZE = 350;\nvar PREVIEW_RECT = {\n  minX: 0,\n  minY: 0,\n  width: PREVIEW_SIZE,\n  height: PREVIEW_SIZE\n};\nvar instructionsText = {\n  initialPrompt: \"Position your face in the circle\",\n  tooClose: \"You're too close or far. Hold the device further.\",\n  eyeClosed: \"Your eyes are closed.\",\n  faceAngle: \"Your face is not aligned.\",\n  performActions: \"Keep the device still.\"\n};\n\nvar Profile = function Profile(_ref) {\n  var navigation = _ref.navigation,\n      previous = _ref.previous;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      faceDetected = _useState2[0],\n      setfaceDetected = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      faceTooBig = _useState4[0],\n      setfaceTooBig = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      eyeClosed = _useState6[0],\n      seteyeClosed = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      headFront = _useState8[0],\n      setheadFront = _useState8[1];\n\n  var _useState9 = useState(PREVIEW_RECT),\n      _useState10 = _slicedToArray(_useState9, 2),\n      box = _useState10[0],\n      setBox = _useState10[1];\n\n  var isFocused = useIsFocused();\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      hasPermission = _useState12[0],\n      setHasPermission = _useState12[1];\n\n  useEffect(function () {\n    (function _callee() {\n      var _await$Camera$request, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Camera.requestPermissionsAsync());\n\n            case 2:\n              _await$Camera$request = _context.sent;\n              status = _await$Camera$request.status;\n              setHasPermission(status === \"granted\");\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n\n  var onFacesDetected = function onFacesDetected(result) {\n    if (result.faces.length !== 1) {\n      setfaceDetected(false);\n      setfaceTooBig(false);\n      return;\n    }\n\n    var face = result.faces[0];\n    var faceRect = {\n      minX: face.bounds.origin.x,\n      minY: face.bounds.origin.y,\n      width: face.bounds.size.width,\n      height: face.bounds.size.height\n    };\n    var edgeOffset = 50;\n\n    var faceRectSmaller = _objectSpread(_objectSpread({}, faceRect), {}, {\n      width: faceRect.width - edgeOffset,\n      height: faceRect.height - edgeOffset\n    });\n\n    var previewContainsFace = contains({\n      outside: PREVIEW_RECT,\n      inside: faceRectSmaller\n    });\n\n    if (!previewContainsFace) {\n      setfaceDetected(false);\n      setfaceTooBig(false);\n      return;\n    }\n\n    var faceMaxSize = PREVIEW_SIZE - 150;\n    var faceMinize = PREVIEW_SIZE - 200;\n\n    if (faceRect.width >= faceMaxSize && faceRect.height >= faceMaxSize) {\n      setfaceTooBig(true);\n      return;\n    } else if (faceRect.width <= faceMinize && faceRect.height <= faceMinize) {\n      setfaceTooBig(true);\n      return;\n    } else {\n      setfaceTooBig(false);\n    }\n\n    setfaceDetected(true);\n    var leftEyeClosed = face.leftEyeOpenProbability <= ACTIONS.BLINK;\n    var rightEyeClosed = face.rightEyeOpenProbability <= ACTIONS.BLINK;\n\n    if (leftEyeClosed || rightEyeClosed) {\n      seteyeClosed(true);\n      return;\n    } else {\n      seteyeClosed(false);\n    }\n\n    if (face.yawAngle <= 350) {\n      setheadFront(true);\n      return;\n    } else {\n      setheadFront(false);\n    }\n\n    setBox(faceRect);\n  };\n\n  return React.createElement(View, {\n    style: {\n      flex: 1\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 5\n    }\n  }, React.createElement(AppBar, {\n    navigation: navigation,\n    previous: previous,\n    title: \"Profile\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }\n  }), React.createElement(Background, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }\n  }, isFocused && hasPermission && React.createElement(View, {\n    style: styles.preview,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 11\n    }\n  }, React.createElement(Camera, {\n    style: styles.camera,\n    type: Camera.Constants.Type.front,\n    onFacesDetected: onFacesDetected,\n    faceDetectorSettings: {\n      mode: FaceDetector.Constants.Mode.fast,\n      detectLandmarks: FaceDetector.Constants.Landmarks.none,\n      runClassifications: FaceDetector.Constants.Classifications.all,\n      minDetectionInterval: 125,\n      tracking: false\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 13\n    }\n  }), faceDetected && !faceTooBig && !eyeClosed && !headFront && React.createElement(View, {\n    style: {\n      top: box.minY,\n      left: box.minX,\n      position: \"absolute\",\n      height: box.height,\n      width: box.width,\n      borderColor: theme.colors.success,\n      borderWidth: 1\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 15\n    }\n  })), React.createElement(View, {\n    style: styles.instructionsContainer,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 9\n    }\n  }, React.createElement(Text, {\n    style: styles.instructions,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 11\n    }\n  }, !faceDetected && !faceTooBig && instructionsText.initialPrompt, faceTooBig && instructionsText.tooClose, faceDetected && !faceTooBig && eyeClosed && instructionsText.eyeClosed, faceDetected && !faceTooBig && !eyeClosed && headFront && instructionsText.faceAngle, faceDetected && !faceTooBig && !eyeClosed && !headFront && instructionsText.performActions))));\n};\n\nvar styles = StyleSheet.create({\n  preview: {\n    height: PREVIEW_SIZE,\n    width: PREVIEW_SIZE,\n    borderRadius: PREVIEW_SIZE / 2,\n    overflow: \"hidden\",\n    borderWidth: 5,\n    borderColor: theme.colors.primary\n  },\n  camera: {\n    height: PREVIEW_SIZE,\n    width: PREVIEW_SIZE\n  },\n  instructions: {\n    fontSize: 20,\n    textAlign: \"center\",\n    top: 10,\n    position: \"absolute\"\n  },\n  instructionsContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  }\n});\nexport default memo(Profile);","map":{"version":3,"sources":["C:/Users/Umar/Music/my-app/screens/Profile.tsx"],"names":["React","memo","useEffect","useState","FaceDetector","useIsFocused","Camera","contains","theme","Background","AppBar","Dimensions","get","windowWidth","width","ACTIONS","BLINK","TURN_HEAD_LEFT","TURN_HEAD_RIGHT","PREVIEW_SIZE","PREVIEW_RECT","minX","minY","height","instructionsText","initialPrompt","tooClose","eyeClosed","faceAngle","performActions","Profile","navigation","previous","faceDetected","setfaceDetected","faceTooBig","setfaceTooBig","seteyeClosed","headFront","setheadFront","box","setBox","isFocused","hasPermission","setHasPermission","requestPermissionsAsync","status","onFacesDetected","result","faces","length","face","faceRect","bounds","origin","x","y","size","edgeOffset","faceRectSmaller","previewContainsFace","outside","inside","faceMaxSize","faceMinize","leftEyeClosed","leftEyeOpenProbability","rightEyeClosed","rightEyeOpenProbability","yawAngle","flex","styles","preview","camera","Constants","Type","front","mode","Mode","fast","detectLandmarks","Landmarks","none","runClassifications","Classifications","all","minDetectionInterval","tracking","top","left","position","borderColor","colors","success","borderWidth","instructionsContainer","instructions","StyleSheet","create","borderRadius","overflow","primary","fontSize","textAlign","justifyContent","alignItems"],"mappings":"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","sourcesContent":["import React, { memo, useEffect, useState } from \"react\";\r\nimport { StyleSheet, View, Dimensions } from \"react-native\";\r\nimport * as FaceDetector from \"expo-face-detector\";\r\nimport { useIsFocused } from \"@react-navigation/native\";\r\nimport { Camera, FaceDetectionResult } from \"expo-camera\";\r\nimport { Navigation, Rectangle, contains } from \"../navigation/types\";\r\nimport { theme } from \"../core/theme\";\r\nimport Background from \"../components/Background\";\r\nimport AppBar from \"../components/AppBar\";\r\nimport { Text } from \"react-native\";\r\n\r\nconst { width: windowWidth } = Dimensions.get(\"window\");\r\n\r\nconst ACTIONS = {\r\n  BLINK: 0.3,\r\n  TURN_HEAD_LEFT: -15,\r\n  TURN_HEAD_RIGHT: 15,\r\n};\r\n\r\nconst PREVIEW_SIZE = 350;\r\n\r\nconst PREVIEW_RECT = {\r\n  minX: 0,\r\n  minY: 0,\r\n  width: PREVIEW_SIZE,\r\n  height: PREVIEW_SIZE,\r\n};\r\n\r\nconst instructionsText = {\r\n  initialPrompt: \"Position your face in the circle\",\r\n  tooClose: \"You're too close or far. Hold the device further.\",\r\n  eyeClosed: \"Your eyes are closed.\",\r\n  faceAngle: \"Your face is not aligned.\",\r\n  performActions: \"Keep the device still.\",\r\n};\r\n\r\ntype Props = {\r\n  navigation: Navigation;\r\n  previous: any;\r\n};\r\n\r\nconst Profile = ({ navigation, previous }: Props) => {\r\n  const [faceDetected, setfaceDetected] = useState(false);\r\n  const [faceTooBig, setfaceTooBig] = useState(false);\r\n  const [eyeClosed, seteyeClosed] = useState(false);\r\n  const [headFront, setheadFront] = useState(false);\r\n  const [box, setBox] = useState(PREVIEW_RECT);\r\n  const isFocused = useIsFocused();\r\n  const [hasPermission, setHasPermission] = useState(false);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const { status } = await Camera.requestPermissionsAsync();\r\n      setHasPermission(status === \"granted\");\r\n    })();\r\n  }, []);\r\n\r\n  const onFacesDetected = (result: FaceDetectionResult) => {\r\n    // 1. There is only a single face in the detection results.\r\n    if (result.faces.length !== 1) {\r\n      setfaceDetected(false);\r\n      setfaceTooBig(false);\r\n      return;\r\n    }\r\n\r\n    const face = result.faces[0];\r\n    const faceRect: Rectangle = {\r\n      minX: face.bounds.origin.x,\r\n      minY: face.bounds.origin.y,\r\n      width: face.bounds.size.width,\r\n      height: face.bounds.size.height,\r\n    };\r\n\r\n    // 2. The face is fully contained within the camera preview.\r\n    const edgeOffset = 50;\r\n    const faceRectSmaller: Rectangle = {\r\n      ...faceRect,\r\n      width: faceRect.width - edgeOffset,\r\n      height: faceRect.height - edgeOffset,\r\n    };\r\n    const previewContainsFace = contains({\r\n      outside: PREVIEW_RECT,\r\n      inside: faceRectSmaller,\r\n    });\r\n    if (!previewContainsFace) {\r\n      setfaceDetected(false);\r\n      setfaceTooBig(false);\r\n      return;\r\n    }\r\n\r\n    // 3. The face is not as big as the camera preview.\r\n    const faceMaxSize = PREVIEW_SIZE - 150;\r\n    const faceMinize = PREVIEW_SIZE - 200;\r\n    if (faceRect.width >= faceMaxSize && faceRect.height >= faceMaxSize) {\r\n      setfaceTooBig(true);\r\n      return;\r\n    } else if (faceRect.width <= faceMinize && faceRect.height <= faceMinize) {\r\n      setfaceTooBig(true);\r\n      return;\r\n    } else {\r\n      setfaceTooBig(false);\r\n    }\r\n    setfaceDetected(true);\r\n\r\n    // 4. Check Eyes closed\r\n    const leftEyeClosed = face.leftEyeOpenProbability <= ACTIONS.BLINK;\r\n    const rightEyeClosed = face.rightEyeOpenProbability <= ACTIONS.BLINK;\r\n    if (leftEyeClosed || rightEyeClosed) {\r\n      seteyeClosed(true);\r\n      return;\r\n    } else {\r\n      seteyeClosed(false);\r\n    }\r\n    // 5. Check Face\r\n    if (face.yawAngle <= 350) {\r\n      setheadFront(true);\r\n      return;\r\n    } else {\r\n      setheadFront(false);\r\n    }\r\n\r\n    setBox(faceRect);\r\n  };\r\n\r\n  return (\r\n    <View\r\n      style={{\r\n        flex: 1,\r\n      }}\r\n    >\r\n      <AppBar navigation={navigation} previous={previous} title=\"Profile\" />\r\n      <Background>\r\n        {isFocused && hasPermission && (\r\n          <View style={styles.preview}>\r\n            <Camera\r\n              style={styles.camera}\r\n              type={Camera.Constants.Type.front}\r\n              onFacesDetected={onFacesDetected}\r\n              faceDetectorSettings={{\r\n                mode: FaceDetector.Constants.Mode.fast, // ignore faces in the background\r\n                detectLandmarks: FaceDetector.Constants.Landmarks.none,\r\n                runClassifications: FaceDetector.Constants.Classifications.all,\r\n                minDetectionInterval: 125,\r\n                tracking: false,\r\n              }}\r\n            />\r\n            {faceDetected && !faceTooBig && !eyeClosed && !headFront && (\r\n              <View\r\n                style={{\r\n                  top: box.minY,\r\n                  left: box.minX,\r\n                  position: \"absolute\",\r\n                  height: box.height,\r\n                  width: box.width,\r\n                  borderColor: theme.colors.success,\r\n                  borderWidth: 1,\r\n                }}\r\n              ></View>\r\n            )}\r\n          </View>\r\n        )}\r\n        <View style={styles.instructionsContainer}>\r\n          <Text style={styles.instructions}>\r\n            {!faceDetected && !faceTooBig && instructionsText.initialPrompt}\r\n            {faceTooBig && instructionsText.tooClose}\r\n            {faceDetected &&\r\n              !faceTooBig &&\r\n              eyeClosed &&\r\n              instructionsText.eyeClosed}\r\n            {faceDetected &&\r\n              !faceTooBig &&\r\n              !eyeClosed &&\r\n              headFront &&\r\n              instructionsText.faceAngle}\r\n            {faceDetected &&\r\n              !faceTooBig &&\r\n              !eyeClosed &&\r\n              !headFront &&\r\n              instructionsText.performActions}\r\n          </Text>\r\n        </View>\r\n      </Background>\r\n    </View>\r\n  );\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  preview: {\r\n    height: PREVIEW_SIZE,\r\n    width: PREVIEW_SIZE,\r\n    borderRadius: PREVIEW_SIZE / 2,\r\n    overflow: \"hidden\",\r\n    borderWidth: 5,\r\n    borderColor: theme.colors.primary,\r\n  },\r\n  camera: {\r\n    height: PREVIEW_SIZE,\r\n    width: PREVIEW_SIZE,\r\n  },\r\n  instructions: {\r\n    fontSize: 20,\r\n    textAlign: \"center\",\r\n    top: 10,\r\n    position: \"absolute\",\r\n  },\r\n  instructionsContainer: {\r\n    flex: 1,\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n});\r\n\r\nexport default memo(Profile);\r\n"]},"metadata":{},"sourceType":"module"}